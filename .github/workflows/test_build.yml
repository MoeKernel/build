name: Test Workflow

on:
  workflow_dispatch

jobs:
  build_ci:
    runs-on: ubuntu-latest

    steps:
      - name: Clone Repo Scripts
        uses: MoeKernel/github-repo-action@v3.1
        with:
          owner: 'MoeKernel'
          branch: 'ksu'
          repository: 'scripts'

      - name: Move Scripts
        working-directory: ./scripts
        run: |
          chmod +x ksu_update.sh build_ci 
          cp build_ci build_count.txt ksu_update.sh ../android_kernel_xiaomi_ginkgo

      - name: Github Configs
        working-directory: ./android_kernel_xiaomi_ginkgo
        run: |
          git config --global user.email "akariondev@gmail.com"
          git config --global user.name "ginkgo"
  
      - name: Move CI Build count
        working-directory: ./android_kernel_xiaomi_ginkgo
        run: |
          cp build_count.txt ../scripts

      - name: Commit Update
        working-directory: ./scripts
        run: |
          git config --global user.email "barryofc11@gmail.com"
          git config --global user.name "Akari"
          git remote set-url origin git@github.com:MoeKernel/scripts.git

          git add build_count.txt
          git commit -m "update build count"
          git push origin ksu -f
